---
sidebar_position: 2
---

# 2.Nh√≥m h√†m PublishService


## H√†m ph√°t h√†nh h√≥a ƒë∆°n

L·∫≠p v√† ph√°t h√†nh h√≥a ƒë∆°n ƒëi·ªán t·ª≠ kh·ªüi t·∫°o t·ª´ m√°y t√≠nh ti·ªÅn: `ImportAndPublishInvMTT`:

H√†m: `ImportAndPublishInvMTT(Account, ACpass, xmlInvData, username, password, pattern, serial, convert)`

ƒê√¢y l√† web service cho ph√©p ph√°t h√†nh h√≥a ƒë∆°n v·ªõi d·ªØ li·ªáu XML c·ªßa kh√°ch h√†ng, t·ªëi ƒëa cho 5000 h√≥a ƒë∆°n.

### **Tham s·ªë ƒë·∫ßu v√†o:**

  - Account/ACpass: l√† t√†i kho·∫£n, m·∫≠t kh·∫©u ƒëƒÉng nh·∫≠p v√†o website Cadmin. 
  - xmlInvData: l√† c·∫•u tr√∫c XML d·ªØ li·ªáu ch·ª©a th√¥ng tin h√≥a ƒë∆°n.
  - username/password: l√† t√†i kho·∫£n, m·∫≠t kh·∫©u RoleService.
  - pattern/serial: l√† m·∫´u s·ªë v√† k√Ω hi·ªáu. 
  - convert: ƒë·ªÉ m·∫∑c ƒë·ªãnh l√† 0.

```md title="M·∫´u b·∫£n tin XML"
<DSHDon>
    <HDon>
  <key>Fkey cua hoa don</key>
  <DLHDon>
     <TTChung>
    <NLap> Ng√†y l·∫≠p (ƒë·ªãnh d·∫°ng theo chu·∫©n thu·∫ø: yyyy-MM-dd)</Nlap>
    <DVTTe>ƒê∆°n v·ªã ti·ªÅn t·ªá *</DVTTe>
    <TGia>T·ª∑ gi√° (B·∫Øt bu·ªôc (Tr·ª´ tr∆∞·ªùng h·ª£p ƒê∆°n v·ªã ti·ªÅn t·ªá l√† VND))</TGia>
    <HTTToan>H√¨nh th·ª©c thanh to√°n </HTTToan>
    <TTKhac>
        <TTin>
          <TTruong>Extra</TTruong>
          <KDLieu>string</KDLieu>
          <DLieu>Extra test</DLieu>
        </TTin>
        <TTin>
          <TTruong>Extra1</TTruong>
          <KDLieu>string</KDLieu>
          <DLieu>Extra1 test</DLieu>
        </TTin>
        <TTin>
          <TTruong>Extra2</TTruong>
          <KDLieu>string</KDLieu>
          <DLieu>Extra2 test</DLieu>
        </TTin>
      </TTKhac>
     </TTChung>
     <NDHDon>
    <NMua>
      <Ten>T√™n</Ten>
      <MST>M√£ s·ªë thu·∫ø</MST>
      <SDThoai>S·ªë ƒëi·ªán tho·∫°i</SDThoai>
      <CCCDan>CƒÉn c∆∞·ªõc c√¥ng d√¢n </CCCDan>
      <DCTDTu>ƒê·ªãa ch·ªâ th∆∞ ƒëi·ªán t·ª≠ </DCTDTu>
      <MKHang>M√£ kh√°ch h√†ng </MKHang>
      <DChi>ƒê·ªãa ch·ªâ</DChi>
      <HVTNMHang>H·ªç v√† t√™n ng∆∞·ªùi mua h√†ng </HVTNMHang>
      <STKNHang>S·ªë t√†i kho·∫£n ng√¢n h√†ng</STKNHang>
      <TNHang>T√™n ng√¢n h√†ng</TNHang>
      <TTKhac>
          <TTin>
            <TTruong>Extra6</TTruong>  <!--s·ª≠ d·ª•ng cho th√¥ng tin qu·ªëc t·ªãch-->
            <KDLieu>string</KDLieu>
             <DLieu>Extra6 test</DLieu>
          </TTin>
          <TTin>
            <TTruong>Extra7</TTruong><!--s·ª≠ d·ª•ng cho th√¥ng tin h·ªô chi·∫øu-->
            <KDLieu>string</KDLieu>
            <DLieu>Extra7 test</DLieu>
          </TTin>
          <TTin>
            <TTruong>Extra8</TTruong>
            <KDLieu>string</KDLieu>
            <DLieu>Extra8 test</DLieu>
          </TTin>
        </TTKhac>
    </NMua>
    <DSHHDVu>
      <HHDVu>
        <TChat>T√≠nh ch·∫•t * (1-H√†ng h√≥a, d·ªãch v·ª•; 2-Khuy·∫øn m·∫°i; 3-Chi·∫øt kh·∫•u th∆∞∆°ng m·∫°i (trong tr∆∞·ªùng h·ª£p mu·ªën th·ªÉ hi·ªán th√¥ng tin chi·∫øt kh·∫•u theo d√≤ng); 4-Ghi ch√∫/di·ªÖn gi·∫£i)</TChat>
        <STT>S·ªë th·ª© t·ª±</STT>
        <MHHDVu>M√£ h√†ng h√≥a, d·ªãch v·ª• (B·∫Øt bu·ªôc n·∫øu c√≥)</MHHDVu>
        <THHDVu>T√™n h√†ng h√≥a, d·ªãch v·ª• *</THHDVu>
        <DVTinh>ƒê∆°n v·ªã t√≠nh (B·∫Øt bu·ªôc n·∫øu c√≥)</DVTinh>
        <SLuong>S·ªë l∆∞·ª£ng (B·∫Øt bu·ªôc n·∫øu c√≥)</SLuong>
        <DGia>ƒê∆°n gi√° (B·∫Øt bu·ªôc n·∫øu c√≥)</DGia>
        <TLCKhau>T·ª∑ l·ªá % chi·∫øt kh·∫•u</TLCKhau>
        <STCKhau>S·ªë ti·ªÅn chi·∫øt kh·∫•u </STCKhau>
        <ThTien>Th√†nh ti·ªÅn (Th√†nh ti·ªÅn ch∆∞a c√≥ thu·∫ø GTGT) - B·∫Øt bu·ªôc tr·ª´ tr∆∞·ªùng h·ª£p TChat = 4</ThTien>
        <TSuat>Thu·∫ø su·∫•t (Thu·∫ø su·∫•t thu·∫ø GTGT)  Nh·∫≠n c√°c gi√° tr·ªã: -2 (KKKNT), -1 (KCT), 0, 5, 8, 10, 12.34 (thu·∫ø kh√°c: AB.CD), -3 (KHAC) </TSuat> <!--s·ª≠ d·ª•ng h√≥a ƒë∆°n GTGT-->
        <TThue>Ti·ªÅn thu·∫ø</TThue><!--s·ª≠ d·ª•ng h√≥a ƒë∆°n GTGT-->
                      <TSThue>Ti·ªÅn sau thu·∫ø</TSThue><!--s·ª≠ d·ª•ng h√≥a ƒë∆°n GTGT-->
        <TTKhac>
          <TTin>
            <TTruong>Extra1</TTruong>
            <KDLieu>string</KDLieu>
             <DLieu>Extra1 pd test</DLieu>
          </TTin>
          <TTin>
            <TTruong>Extra2</TTruong>
            <KDLieu>string</KDLieu>
            <DLieu>Extra2 pd test</DLieu>
          </TTin>
          </TTKhac>
        
      </HHDVu>
    </DSHHDVu>
    <TToan>
      <THTTLTSuat><!--s·ª≠ d·ª•ng h√≥a ƒë∆°n GTGT-->
        <LTSuat>
          <TSuat>Thu·∫ø su·∫•t (Thu·∫ø su·∫•t thu·∫ø GTGT)  Nh·∫≠n c√°c gi√° tr·ªã: -2 (KKKNT), -1 (KCT), 0, 5, 8, 10, 12.34 (thu·∫ø kh√°c: AB.CD), -3 (KHAC) </TSuat>
          <TThue>Ti·ªÅn thu·∫ø (Ti·ªÅn thu·∫ø GTGT)</TThue>
          <ThTien>Th√†nh ti·ªÅn (Th√†nh ti·ªÅn ch∆∞a c√≥ thu·∫ø GTGT)</ThTien>
        </LTSuat>
      </THTTLTSuat>
      <TgTCThue>T·ªïng ti·ªÅn ch∆∞a thu·∫ø (T·ªïng c·ªông th√†nh ti·ªÅn ch∆∞a c√≥ thu·∫ø GTGT) (B·∫Øt bu·ªôc v·ªõi h√≥a ƒë∆°n GTGT)</TgTCThue><!--s·ª≠ d·ª•ng h√≥a ƒë∆°n GTGT-->
      <TgTThue>T·ªïng ti·ªÅn thu·∫ø (T·ªïng c·ªông ti·ªÅn thu·∫ø GTGT) (B·∫Øt bu·ªôc v·ªõi h√≥a ƒë∆°n GTGT)</TgTThue><!--s·ª≠ d·ª•ng h√≥a ƒë∆°n GTGT-->
      <TTCKTMai>T·ªïng ti·ªÅn chi·∫øt kh·∫•u th∆∞∆°ng m·∫°i</TTCKTMai>
      <TgTTTBSo>T·ªïng ti·ªÅn thanh to√°n b·∫±ng s·ªë *</TgTTTBSo>
      <TgTTTBChu>T·ªïng ti·ªÅn thanh to√°n b·∫±ng ch·ªØ *</TgTTTBChu>
      <TTKhac>
          <TTin>
            <TTruong>Extra9</TTruong>
            <KDLieu>string</KDLieu>
             <DLieu>Extra9 test</DLieu>
          </TTin>
          <TTin>
            <TTruong>Extra10</TTruong>
            <KDLieu>string</KDLieu>
            <DLieu>Extra10 test</DLieu>
          </TTin>
          <TTin>
            <TTruong>Extra11</TTruong>
            <KDLieu>DateTime</KDLieu>
            <DLieu>ƒë·ªãnh d·∫°ng theo chu·∫©n thu·∫ø:(v√≠ d·ª•: yyyy-MM-dd)</DLieu>
          </TTin>
        </TTKhac>
    </TToan>
  </NDHDon>
    </DLHDon>
  </HDon>
</DSHDon>
```
### K·∫øt qu·∫£ ƒë·∫ßu ra
N·∫øu h√†m g·ª≠i th√†nh c√¥ng, k·∫øt qu·∫£ ƒë·∫ßu ra s·∫Ω l√†:

```shell
OK:" + pattern + ";" + serial + "-" + fkey + "_" + invNumber + "_" + MCCQT

```
Trong ƒë√≥:
- OK ü°™ ƒë√£ ph√°t h√†nh h√≥a ƒë∆°n th√†nh c√¥ng
- Patternü°™ M·∫´u s·ªë c·ªßa h√≥a ƒë∆°n 
- Serial ü°™ serial c·ªßa h√≥a ƒë∆°n
- Fkey-> fkey c·ªßa h√≥a ƒë∆°n

### M√£ l·ªói trong qu√° tr√¨nh t√≠ch h·ª£p

:::danger ERR1

T√†i kho·∫£n ƒëƒÉng nh·∫≠p sai ho·∫∑c kh√¥ng c√≥ quy·ªÅn th√™m m·ªõi h√≥a ƒë∆°n

:::

:::danger ERR2

Pattern ho·∫∑c serial truy·ªÅn v√†o r·ªóng

:::

:::danger ERR3

D·ªØ li·ªáu xml ƒë·∫ßu v√†o kh√¥ng ƒë√∫ng quy ƒë·ªãnh

:::

:::danger ERR4

Kh√¥ng l·∫•y ƒë∆∞·ª£c th√¥ng tin c√¥ng ty (currentCompany null)

:::

:::danger ERR5

T√†i kho·∫£n ƒëƒÉng nh·∫≠p sai ho·∫∑c kh√¥ng c√≥ quy·ªÅn th√™m m·ªõi h√≥a ƒë∆°n

:::

:::danger ERR6

Kh√¥ng ƒë·ªß s·ªë l∆∞·ª£ng h√≥a ƒë∆°n cho l√¥ th√™m m·ªõi

:::
:::danger ERR7

User name kh√¥ng ph√π h·ª£p, kh√¥ng t√¨m th·∫•y user.

:::
:::danger ERR11

Pattern ho·∫∑c serial kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng

:::
:::danger ERR13

Danh s√°ch h√≥a ƒë∆°n t·ªìn t·∫°i h√≥a ƒë∆°n tr√πng Fkey

:::
:::danger ERR15

Ng√†y l·∫≠p truy·ªÅn v√†o l·ªõn h∆°n ng√†y hi·ªán t·∫°i ho·∫∑c XML kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng (h√≥a ƒë∆°n ngo·∫°i t·ªá kh√¥ng truy·ªÅn t·ª∑ gi√°) 
:::
:::danger ERR20

Pattern v√† serial kh√¥ng ph√π h·ª£p, ho·∫∑c kh√¥ng t·ªìn t·∫°i h√≥a ƒë∆°n ƒë√£ ƒëƒÉng k√Ω c√≥ s·ª≠ d·ª•ng Pattern v√† Serial truy·ªÅn v√†o

:::

:::danger ERR5

Kh√¥ng ph√°t h√†nh ƒë∆∞·ª£c h√≥a ƒë∆°n

:::
:::danger ERR10

L√¥ c√≥ s·ªë h√≥a ƒë∆°n v∆∞·ª£t qu√° max cho ph√©p

:::
:::danger ERR21

Tr√πng s·ªë h√≥a ƒë∆°n

:::
:::danger ERR22

Th√¥ng tin ng∆∞·ªùi b√°n v∆∞·ª£t maxlength

:::
:::danger ERR23

M√£ CQT r·ªóng

:::
:::danger ERR30

Danh s√°ch h√≥a ƒë∆°n t·ªìn t·∫°i ng√†y h√≥a ƒë∆°n nh·ªè h∆°n ng√†y h√≥a ƒë∆°n ƒë√£ ph√°t h√†nh

:::
